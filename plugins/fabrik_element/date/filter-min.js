/*! Fabrik */
var DateFilter=new Class({Implements:[Options],options:{calendarSetup:{eventName:"click",ifFormat:"%Y/%m/%d",daFormat:"%Y/%m/%d",singleClick:!0,align:"Br",range:[1900,2999],showsTime:!1,timeFormat:"24",electric:!0,step:2,cache:!1,showOthers:!1}},initialize:function(t){this.setOptions(t),this.cals=$H({});for(var a=0;a<this.options.ids.length;a++)this.makeCalendar(this.options.ids[a],this.options.buttons[a])},makeCalendar:function(s,t){var a,i,e;if(this.cals[s])this.cals[s].show();else if(t=document.id(t),"null"!==typeOf(t))return this.addEventToCalOpts(),(a=Object.clone(this.options.calendarSetup)).inputField=document.id(s),i=a.inputField||a.displayArea,e=a.inputField?a.ifFormat:a.daFormat,this.cals[s]=null,i&&(a.date=Date.parseDate(i.value||i.innerHTML,e)),this.cals[s]=new Calendar(a.firstDay,a.date,a.onSelect,a.onClose),this.cals[s].setDateStatusHandler(a.dateStatusFunc),this.cals[s].setDateToolTipHandler(a.dateTooltipFunc),this.cals[s].showsTime=a.showsTime,this.cals[s].time24="24"===a.timeFormat.toString(),this.cals[s].weekNumbers=a.weekNumbers,this.cals[s].showsOtherMonths=a.showOthers,this.cals[s].yearStep=a.step,this.cals[s].setRange(a.range[0],a.range[1]),this.cals[s].params=a,this.cals[s].params.button=t,this.cals[s].getDateText=a.dateText,this.cals[s].setDateFormat(e),this.cals[s].create(),this.cals[s].refresh(),this.cals[s].hide(),t.addEvent("click",function(t){t.stop(),this.cals[s].params.position?this.cal.showAt(this.cals[s].params.position[0],paramss[s].position[1]):this.cals[s].showAtElement(this.cals[s].params.button||this.cals[s].params.displayArea||this.cals[s].params.inputField,this.cals[s].params.align),this.cals[s].show()}.bind(this)),this.cals[s].params.inputField.addEvent("blur",function(t){var a=this.cals[s].params.inputField.value;""!==a&&(a=Date.parseDate(a,this.cals[s].params.ifFormat),this.cals[s].date=a)}.bind(this)),function(){this.cals[s].hide()}.delay(100,this),this.cals[s]},dateSelect:function(t){return!1},calSelect:function(t,a){this.update(t,t.date.format("db")),t.dateClicked&&t.callCloseHandler()},calClose:function(t){t.hide()},update:function(t,a){a&&("string"===typeOf(a)&&(a=Date.parse(a)),t.params.inputField.value=a.format(this.options.calendarSetup.ifFormat))},addEventToCalOpts:function(){this.options.calendarSetup.onSelect=function(t,a){this.calSelect(t,a)}.bind(this),this.options.calendarSetup.dateStatusFunc=function(t){return this.dateSelect(t)}.bind(this),this.options.calendarSetup.onClose=function(t){this.calClose(t)}.bind(this)},onSubmit:function(){this.cals.each(function(t){""!==t.params.inputField.value&&(t.params.inputField.value=t.date.format("db"))}.bind(this))},onUpdateData:function(){this.cals.each(function(t){""!==t.params.inputField.value&&this.update(t,t.date)}.bind(this))}});