/*! Fabrik */
define(["jquery","fab/element"],function(t,e){return window.FbTextarea=new Class({Extends:e,initialize:function(t,e){this.setPlugin("fabriktextarea"),this.parent(t,e),this.periodFn=function(){this.getTextContainer(),"undefined"!=typeof tinyMCE&&!1===this.container||(clearInterval(n),this.watchTextContainer())};var n=this.periodFn.periodical(200,this);Fabrik.addEvent("fabrik.form.page.change.end",function(t){this.refreshEditor()}.bind(this)),Fabrik.addEvent("fabrik.form.submit.start",function(t){this.options.wysiwyg&&t.options.ajax&&"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave()}.bind(this))},unclonableProperties:function(){var t=this.parent();return t.push("container"),t},cloneUpdateIds:function(t){this.element=document.id(t),this.options.element=t,this.options.htmlId=t},watchTextContainer:function(){var t;"null"===typeOf(this.element)&&(this.element=document.id(this.options.element)),"null"===typeOf(this.element)&&(this.element=document.id(this.options.htmlId),"null"===typeOf(this.element))||!0===this.options.editable&&(!1===(t=this.getContainer())?fconsole("no fabrikElementContainer class found for textarea"):(t=t.getElement(".fabrik_characters_left"),"null"!==typeOf(t)&&(this.warningFX=new Fx.Morph(t,{duration:1e3,transition:Fx.Transitions.Quart.easeOut}),this.origCol=t.getStyle("color"),this.options.wysiwyg&&"undefined"!=typeof tinymce?((t=this._getTinyInstance()).on("keyup",function(t){this.informKeyPress(t)}.bind(this)),t.on("focus",function(t){var e=this.element.getParent(".fabrikElementContainer");e.getElement("span.badge").addClass("badge-info"),e.getElement(".fabrik_characters_left").removeClass("muted")}.bind(this)),t.on("blur",function(t){var e=this.element.getParent(".fabrikElementContainer");e.getElement("span.badge").removeClass("badge-info"),e.getElement(".fabrik_characters_left").addClass("muted")}.bind(this)),t.on("blur",function(t){this.forwardEvent("blur")}.bind(this))):"null"!==typeOf(this.container)&&(this.container.addEvent("keydown",function(t){this.informKeyPress(t)}.bind(this)),this.container.addEvent("blur",function(t){this.blurCharsLeft(t)}.bind(this)),this.container.addEvent("focus",function(t){this.focusCharsLeft(t)}.bind(this))))))},forwardEvent:function(t){var e=tinyMCE.activeEditor.getElement(),n=this.getContent();e.set("value",n),e.fireEvent("blur",new Event.Mock(e,t))},focusCharsLeft:function(){var t=this.element.getParent(".fabrikElementContainer");t.getElement("span.badge").addClass("badge-info"),t.getElement(".fabrik_characters_left").removeClass("muted")},blurCharsLeft:function(){var t=this.element.getParent(".fabrikElementContainer");t.getElement("span.badge").removeClass("badge-info"),t.getElement(".fabrik_characters_left").addClass("muted")},getCloneName:function(){return this.options.wysiwyg&&this.options.isGroupJoin?this.options.htmlId:this.options.element},cloned:function(t){var e,n,i;this.options.wysiwyg&&(e=(i=this.element.getParent(".fabrikElement")).getElement("textarea").clone(!0,!0),n=i.getElement(".fabrik_characters_left"),i.empty(),i.adopt(e),"null"!==typeOf(n)&&i.adopt(n.clone()),e.removeClass("mce_editable"),e.setStyle("display",""),this.element=e,i=this.options.isGroupJoin?this.options.htmlId:this.options.element,this._addTinyEditor(i)),this.getTextContainer(),this.watchTextContainer(),this.parent(t)},decloned:function(t){var e;this.options.wysiwyg&&(e=this.options.isGroupJoin?this.options.htmlId:this.options.element,tinyMCE.execCommand("mceFocus",!1,e),this._removeTinyEditor(e)),this.parent(t)},getTextContainer:function(){var t;return this.options.wysiwyg&&this.options.editable?(t=this.options.isGroupJoin?this.options.htmlId:this.options.element,document.id(t).addClass("fabrikinput"),(t="undefined"!=typeof tinyMCE&&tinyMCE.get(t))?this.container=t.getDoc():this.contaner=!1):(this.element=document.id(this.options.element),this.container=this.element),this.container},getContent:function(){return this.options.wysiwyg?tinyMCE.activeEditor.getContent().replace(/<\/?[^>]+(>|$)/g,""):this.container.value},refreshEditor:function(){this.options.wysiwyg&&("undefined"!=typeof WFEditor?WFEditor.init(WFEditor.settings):"undefined"!=typeof tinymce&&tinyMCE.init(tinymce.settings),this.watchTextContainer())},_getTinyInstance:function(){return tinyMCE.get(this.element.id)},_addTinyEditor:function(t){tinyMCE.execCommand("mceAddEditor",!1,t)},_removeTinyEditor:function(t){tinyMCE.execCommand("mceRemoveEditor",!1,t)},setContent:function(t){var e;return this.options.wysiwyg?(e=this._getTinyInstance().setContent(t),this.moveCursorToEnd(),e):(this.getTextContainer(),"null"!==typeOf(this.container)&&(this.container.value=t),null)},moveCursorToEnd:function(){var t=this._getTinyInstance();t.selection.select(t.getBody(),!0),t.selection.collapse(!1)},informKeyPress:function(){var t=this.getContainer().getElement(".fabrik_characters_left"),e=(this.getContent(),this.itemsLeft());this.limitReached()?(this.limitContent(),this.warningFX.start({opacity:0,color:"#FF0000"}).chain(function(){this.start({opacity:1,color:"#FF0000"}).chain(function(){this.start({opacity:0,color:this.origCol}).chain(function(){this.start({opacity:1})})})})):t.setStyle("color",this.origCol),t.getElement("span").set("html",e)},itemsLeft:function(){var t=0,e=this.getContent();return t=(t="word"===this.options.maxType?this.options.max-e.split(" ").length:this.options.max-(e.length+1))<0?0:t},limitContent:function(){var t,e=this.getContent();"word"===this.options.maxType?(t=(t=e.split(" ").splice(0,this.options.max)).join(" "),t+=this.options.wysiwyg?"&nbsp;":" "):t=e.substring(0,this.options.max),this.setContent(t)},limitReached:function(){var t=this.getContent();return"word"===this.options.maxType?t.split(" ").length>this.options.max:this.options.max-(t.length+1)<0},reset:function(){this.update(this.options.defaultVal)},update:function(t){this.getElement(),this.getTextContainer(),this.options.editable?this.setContent(t):this.element.set("html",t)}}),window.FbTextarea});
//# sourceMappingURL=textarea-min.js.map