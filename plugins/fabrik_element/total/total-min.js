/*! Fabrik */
define(["jquery","fab/element"],function(d,e){return window.FbTotal=new Class({Extends:e,observeGroupIds:[],observeElementGroups:[],initialize:function(e,t){this.setPlugin("FbTotal"),this.parent(e,t),this.observeGroupIds=[]},attachedToForm:function(){this.options.observe.each(function(e){this.addObserveEvent(e)}.bind(this)),this.options.totalOnLoad&&this.calc(),Fabrik.addEvent("fabrik.cdd.update",function(e){e.hasSubElements()&&-1!==d.inArray(e.baseElementId,this.options.observe)&&this.addObserveEvent(e.baseElementId)}.bind(this)),Fabrik.addEvent("fabrik.form.group.duplicate.end",function(e,t,s){-1!==d.inArray(s,this.observeGroupIds)&&this.calc()}.bind(this)),Fabrik.addEvent("fabrik.form.group.delete.end",function(e,t,s){-1!==d.inArray(s,this.observeGroupIds)&&this.calc()}.bind(this)),this.parent()},addObserveEvent:function(s){var i,o;""!==s&&(this.form.formElements[s]?this.form.formElements[s].addNewEventAux(this.form.formElements[s].getChangeEvent(),function(e){this.calc(e)}.bind(this)):this.options.canRepeat?(i=s+"_"+this.options.repeatCounter,this.form.formElements[i]&&this.form.formElements[i].addNewEventAux(this.form.formElements[i].getChangeEvent(),function(e){this.calc(e)}.bind(this))):this.form.repeatGroupMarkers.each(function(e,t){for(i="",o=0;o<e;o++)i=s+"_"+o,this.form.formElements[i]&&(this.form.formElements[i].addNewEvent(this.form.formElements[i].getChangeEvent(),function(e){this.calc(e)}.bind(this)),-1===d.inArray(t,this.observeGroupIds))&&(this.observeGroupIds.push(t),this.observeElementGroups[s]=t)}.bind(this)))},calc:function(){var n=this,a=parseFloat(this.options.startValue);switch(this.options.method){case"sum_repeat":d.each(this.options.observe,function(e,t){for(var s=n.form.repeatGroupMarkers[n.observeElementGroups[t]],i=0;i<s;i++){var o=n.form.formElements.get(t+"_"+i);if(o){var r=o.getValue();if(d.isNumeric(r)){o=n.options.operands[e],r=parseFloat(r);switch(o){case"add":a+=r;break;case"subtract":a-=r;break;case"multiply":a*=r;break;case"divide":0!==r&&(a/=r)}}}}});break;case"sum_multiple":d.each(this.options.observe,function(e,t){n.options.canRepeat&&(t=t+"_"+n.options.repeatCounter);t=n.form.formElements.get(t);if(t){var s=t.getValue();if(d.isNumeric(s)){t=n.options.operands[e],s=parseFloat(s);switch(t){case"add":a+=s;break;case"subtract":a-=s;break;case"multiply":a*=s;break;case"divide":0!==s&&(a/=s)}}}})}this.update(a.toFixed(n.options.fixed))}}),window.FbTotal});
//# sourceMappingURL=total-min.js.map