/*! Fabrik */
!function(f,p,v){function b(e){return p.getElementById(e)}v.runtimes.Html4=v.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:v.ua.gecko&&f.FormData||v.ua.webkit}},init:function(m,e){m.bind("Init",function(s){var i,r,a,e,t,n,o,d=p.body,l=[],u=/MSIE/.test(navigator.userAgent),c=[],g=s.settings.filters;e:for(e=0;e<g.length;e++)for(t=g[e].extensions.split(/,/),o=0;o<t.length;o++){if("*"===t[o]){c=[];break e}(n=v.mimeTypes[t[o]])&&c.push(n)}c=c.join(","),s.settings.container&&(d=b(s.settings.container),"static"===v.getStyle(d,"position"))&&(d.style.position="relative"),s.bind("UploadFile",function(e,t){var n;t.status!=v.DONE&&t.status!=v.FAILED&&e.state!=v.STOPPED&&(n=b("form_"+t.id),b("input_"+t.id).setAttribute("name",e.settings.file_data_name),n.setAttribute("action",e.settings.url),v.each(v.extend({name:t.target_name||t.name},e.settings.multipart_params),function(e,t){var i=p.createElement("input");v.extend(i,{type:"hidden",name:t,value:e}),n.insertBefore(i,n.firstChild)}),r=t,b("form_"+a).style.top="-1048575px",n.submit(),n.parentNode.removeChild(n))}),s.bind("FileUploaded",function(e){e.refresh()}),s.bind("StateChanged",function(e){var t;e.state==v.STARTED&&((t=p.createElement("div")).innerHTML='<iframe id="'+s.id+'_iframe" name="'+s.id+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',i=t.firstChild,d.appendChild(i),v.addEvent(i,"load",function(e){var t,e=e.target;if(r){try{t=e.contentWindow.document||e.contentDocument||f.frames[e.id].document}catch(e){return void s.trigger("Error",{code:v.SECURITY_ERROR,message:v.translate("Security error."),file:r})}(e=t.body.innerHTML)&&(r.status=v.DONE,r.loaded=1025,r.percent=100,s.trigger("UploadProgress",r),s.trigger("FileUploaded",r,{response:e}))}},s.id)),e.state==v.STOPPED&&f.setTimeout(function(){v.removeEvent(i,"load",e.id),i.parentNode&&i.parentNode.removeChild(i)},0)}),s.bind("Refresh",function(e){var t,i,n,r,o,s=b(e.settings.browse_button);s&&(o=v.getPos(s,b(e.settings.container)),n=v.getSize(s),r=b("form_"+a),b("input_"+a),v.extend(r.style,{top:o.y+"px",left:o.x+"px",width:n.w+"px",height:n.h+"px"}),e.features.triggerDialog&&("static"===v.getStyle(s,"position")&&v.extend(s.style,{position:"relative"}),o=parseInt(s.style.zIndex,10),isNaN(o)&&(o=0),v.extend(s.style,{zIndex:o}),v.extend(r.style,{zIndex:o-1})),t=e.settings.browse_button_hover,i=e.settings.browse_button_active,n=e.features.triggerDialog?s:r,t&&(v.addEvent(n,"mouseover",function(){v.addClass(s,t)},e.id),v.addEvent(n,"mouseout",function(){v.removeClass(s,t)},e.id)),i)&&(v.addEvent(n,"mousedown",function(){v.addClass(s,i)},e.id),v.addEvent(p.body,"mouseup",function(){v.removeClass(s,i)},e.id))}),m.bind("FilesRemoved",function(e,t){for(var i,n=0;n<t.length;n++)(i=b("form_"+t[n].id))&&i.parentNode.removeChild(i)}),m.bind("Destroy",function(e){var t,i,n,r={inputContainer:"form_"+a,inputFile:"input_"+a,browseButton:e.settings.browse_button};for(t in r)(i=b(r[t]))&&v.removeAllEvents(i,e.id);v.removeAllEvents(p.body,e.id),v.each(l,function(e,t){(n=b("form_"+e))&&d.removeChild(n)})}),function i(){var n,r,e,o;a=v.guid(),l.push(a),(n=p.createElement("form")).setAttribute("id","form_"+a),n.setAttribute("method","post"),n.setAttribute("enctype","multipart/form-data"),n.setAttribute("encoding","multipart/form-data"),n.setAttribute("target",s.id+"_iframe"),n.style.position="absolute",(r=p.createElement("input")).setAttribute("id","input_"+a),r.setAttribute("type","file"),r.setAttribute("accept",c),r.setAttribute("size",1),o=b(s.settings.browse_button),s.features.triggerDialog&&o&&v.addEvent(b(s.settings.browse_button),"click",function(e){r.click(),e.preventDefault()},s.id),v.extend(r.style,{width:"100%",height:"100%",opacity:0,fontSize:"999px"}),v.extend(n.style,{overflow:"hidden"}),(e=s.settings.shim_bgcolor)&&(n.style.background=e),u&&v.extend(r.style,{filter:"alpha(opacity=0)"}),v.addEvent(r,"change",function(e){var e=e.target,t=[];e.value&&(b("form_"+a).style.top="-1048575px",e=(e=e.value.replace(/\\/g,"/")).substring(e.length,e.lastIndexOf("/")+1),t.push(new v.File(a,e)),s.features.triggerDialog?v.removeEvent(o,"click",s.id):v.removeAllEvents(n,s.id),v.removeEvent(r,"change",s.id),i(),t.length)&&m.trigger("FilesAdded",t)},s.id),n.appendChild(r),d.appendChild(n),s.refresh()}()}),e({success:!0})}})}(window,document,plupload);