/*! Fabrik */
!function(d,u){var g={},c={};u.flash={trigger:function(t,i,s){setTimeout(function(){var e=g[t];e&&e.trigger("Flash:"+i,s)},0)}},u.runtimes.Flash=u.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(l,t){var e,i,s,n=0,a=d.body;function o(){return d.getElementById(l.id+"_flash")}(function(){var t;try{t=(t=navigator.plugins["Shockwave Flash"]).description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])})()<10?t({success:!1}):(c[l.id]=!1,g[l.id]=l,d.getElementById(l.settings.browse_button),(e=d.createElement("div")).id=l.id+"_flash_container",u.extend(e.style,{position:"absolute",top:"0px",background:l.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),e.className="plupload flash",l.settings.container&&(a=d.getElementById(l.settings.container),"static"===u.getStyle(a,"position"))&&(a.style.position="relative"),a.appendChild(e),s='<object id="'+l.id+'_flash" type="application/x-shockwave-flash" data="'+l.settings.flash_swf_url+'" ',u.ua.ie&&(s+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),s+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+l.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(l.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',u.ua.ie?(i=d.createElement("div"),e.appendChild(i),i.outerHTML=s):e.innerHTML=s,function e(){5e3<n++?t({success:!1}):c[l.id]||setTimeout(e,1)}(),e=null,l.bind("Flash:Init",function(){var r={};o().setFileFilters(l.settings.filters,l.settings.multi_selection),c[l.id]||(c[l.id]=!0,l.bind("UploadFile",function(e,t){var e=e.settings,i=l.settings.resize||{};o().uploadFile(r[t.id],e.url,{name:t.target_name||t.name,mime:u.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:e.chunk_size,width:i.width,height:i.height,quality:i.quality,multipart:e.multipart,multipart_params:e.multipart_params||{},file_data_name:e.file_data_name,format:/\.(jpg|jpeg)$/i.test(t.name)?"jpg":"png",headers:e.headers,urlstream_upload:e.urlstream_upload})}),l.bind("Flash:UploadProcess",function(e,t){var i=e.getFile(r[t.id]);i.status!=u.FAILED&&(i.loaded=t.loaded,i.size=t.size,e.trigger("UploadProgress",i))}),l.bind("Flash:UploadChunkComplete",function(e,t){var i=e.getFile(r[t.id]),s={chunk:t.chunk,chunks:t.chunks,response:t.text};e.trigger("ChunkUploaded",i,s),i.status!=u.FAILED&&o().uploadNextChunk(),t.chunk==t.chunks-1&&(i.status=u.DONE,e.trigger("FileUploaded",i,{response:t.text}))}),l.bind("Flash:SelectFiles",function(e,t){for(var i,s,n=[],a=0;a<t.length;a++)i=t[a],s=u.guid(),r[s]=i.id,r[i.id]=s,n.push(new u.File(s,i.name,i.size));n.length&&l.trigger("FilesAdded",n)}),l.bind("Flash:SecurityError",function(e,t){l.trigger("Error",{code:u.SECURITY_ERROR,message:u.translate("Security error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:GenericError",function(e,t){l.trigger("Error",{code:u.GENERIC_ERROR,message:u.translate("Generic error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:IOError",function(e,t){l.trigger("Error",{code:u.IO_ERROR,message:u.translate("IO error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:ImageError",function(e,t){l.trigger("Error",{code:parseInt(t.code,10),message:u.translate("Image error."),file:l.getFile(r[t.id])})}),l.bind("Flash:StageEvent:rollOver",function(e){var t=d.getElementById(l.settings.browse_button),e=e.settings.browse_button_hover;t&&e&&u.addClass(t,e)}),l.bind("Flash:StageEvent:rollOut",function(e){var t=d.getElementById(l.settings.browse_button),e=e.settings.browse_button_hover;t&&e&&u.removeClass(t,e)}),l.bind("Flash:StageEvent:mouseDown",function(e){var t=d.getElementById(l.settings.browse_button),i=e.settings.browse_button_active;t&&i&&(u.addClass(t,i),u.addEvent(d.body,"mouseup",function(){u.removeClass(t,i)},e.id))}),l.bind("Flash:StageEvent:mouseUp",function(e){var t=d.getElementById(l.settings.browse_button),e=e.settings.browse_button_active;t&&e&&u.removeClass(t,e)}),l.bind("Flash:ExifData",function(e,t){l.trigger("ExifData",l.getFile(r[t.id]),t.data)}),l.bind("Flash:GpsData",function(e,t){l.trigger("GpsData",l.getFile(r[t.id]),t.data)}),l.bind("QueueChanged",function(e){l.refresh()}),l.bind("FilesRemoved",function(e,t){for(var i=0;i<t.length;i++)o().removeFile(r[t[i].id])}),l.bind("StateChanged",function(e){l.refresh()}),l.bind("Refresh",function(e){var t,i;o().setFileFilters(l.settings.filters,l.settings.multi_selection),(i=d.getElementById(e.settings.browse_button))&&(t=u.getPos(i,d.getElementById(e.settings.container)),i=u.getSize(i),u.extend(d.getElementById(e.id+"_flash_container").style,{top:t.y+"px",left:t.x+"px",width:i.w+"px",height:i.h+"px"}))}),l.bind("Destroy",function(e){u.removeAllEvents(d.body,e.id),delete c[e.id],delete g[e.id],(e=d.getElementById(e.id+"_flash_container"))&&a.removeChild(e)}),t({success:!0}))}))}})}((window,document),plupload);