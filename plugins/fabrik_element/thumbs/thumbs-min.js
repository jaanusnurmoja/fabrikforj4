/*! Fabrik */
define(["jquery","fab/element"],function(t,i){return window.FbThumbs=new Class({Extends:i,initialize:function(t,i,s){this.field=document.id(t),this.parent(t,i),this.thumb=s,this.spinner=new Spinner(this.getContainer()),Fabrik.bootstrapped?this.setupj3():(this.thumbup=document.id("thumbup"),this.thumbdown=document.id("thumbdown"),this.options.canUse?(this.imagepath=Fabrik.liveSite+"plugins/fabrik_element/thumbs/images/",this.thumbup.addEvent("mouseover",function(t){this.thumbup.setStyle("cursor","pointer"),this.thumbup.src=this.imagepath+"thumb_up_in.gif"}.bind(this)),this.thumbdown.addEvent("mouseover",function(t){this.thumbdown.setStyle("cursor","pointer"),this.thumbdown.src=this.imagepath+"thumb_down_in.gif"}.bind(this)),this.thumbup.addEvent("mouseout",function(t){this.thumbup.setStyle("cursor",""),"up"===this.options.myThumb?this.thumbup.src=this.imagepath+"thumb_up_in.gif":this.thumbup.src=this.imagepath+"thumb_up_out.gif"}.bind(this)),this.thumbdown.addEvent("mouseout",function(t){this.thumbdown.setStyle("cursor",""),"down"===this.options.myThumb?this.thumbdown.src=this.imagepath+"thumb_down_in.gif":this.thumbdown.src=this.imagepath+"thumb_down_out.gif"}.bind(this)),this.thumbup.addEvent("click",function(t){this.doAjax("up")}.bind(this)),this.thumbdown.addEvent("click",function(t){this.doAjax("down")}.bind(this))):(this.thumbup.addEvent("click",function(t){t.stop(),this.doNoAccess()}.bind(this)),this.thumbdown.addEvent("click",function(t){t.stop(),this.doNoAccess()}.bind(this))))},setupj3:function(){var t=this.getContainer(),i=t.getElement("button.thumb-up"),s=t.getElement("button.thumb-down");i.addEvent("click",function(t){t.stop(),this.options.canUse?(t=!i.hasClass("btn-success"),this.doAjax("up",t),t?(i.addClass("btn-success"),"null"!==typeOf(s)&&s.removeClass("btn-danger")):i.removeClass("btn-success")):this.doNoAccess()}.bind(this)),"null"!==typeOf(s)&&s.addEvent("click",function(t){t.stop(),this.options.canUse?(t=!s.hasClass("btn-danger"),this.doAjax("down",t),t?(s.addClass("btn-danger"),i.removeClass("btn-success")):s.removeClass("btn-danger")):this.doNoAccess()}.bind(this))},doAjax:function(t,i){i=!!i,!1===this.options.editable&&(this.spinner.show(),t={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"thumbs",method:"ajax_rate",g:"element",element_id:this.options.elid,row_id:this.options.row_id,elementname:this.options.elid,userid:this.options.userid,thumb:t,listid:this.options.listid,formid:this.options.formid,add:i},new Request({url:"",data:t,onComplete:function(t){var i,s,n,e;t=JSON.parse(t),this.spinner.hide(),t.error?console.log(t.error):""!==t&&(Fabrik.bootstrapped?((i=this.getContainer()).getElement("button.thumb-up .thumb-count").set("text",t[0]),"null"!==typeOf(i.getElement("button.thumb-down"))&&i.getElement("button.thumb-down .thumb-count").set("text",t[1])):(i=document.id("count_thumbup"),s=document.id("count_thumbdown"),n=document.id("thumbup"),e=document.id("thumbdown"),i.set("html",t[0]),s.set("html",t[1]),this.getContainer().getElement("."+this.field.id).value=t[0].toFloat()-t[1].toFloat(),"1"===t[0]?(n.src=this.imagepath+"thumb_up_in.gif",e.src=this.imagepath+"thumb_down_out.gif"):(n.src=this.imagepath+"thumb_up_out.gif",e.src=this.imagepath+"thumb_down_in.gif")))}.bind(this)}).send())},doNoAccess:function(){""!==this.options.noAccessMsg&&window.alert(this.options.noAccessMsg)}}),window.FbThumbs});