/*! Fabrik */
var FbCanvas=new Class({Implements:[Options],layers:[],ctx:null,ctxEl:null,lastMouseOverTarget:null,dragTarget:null,threads:null,ctxPos:null,cacheCtxPos:!0,initialize:function(t){return this.setOptions(t),t.canvasElement&&this.setCtx(t.canvasElement),this.layers=new LayerHash,t.enableMouse&&this.setupMouse(),t.cacheCtxPos&&(this.cacheCtxPos=this.options.cacheCtxPos),this.threads=new Hash,this.ctxPos=this.ctxEl.getPosition(),this},setDrag:function(t){this.dragTarget=t.fullid},clearDrag:function(){this.dragTarget=null},getMouse:function(t){var e=this.cacheCtxPos?this.ctxPos:this.ctxEl.getPosition();return[t.event.pageX-e.x,t.event.pageY-e.y]},setupMouse:function(){this.ctxEl.addEvents({click:function(t){var e,t=this.getMouse(t);(e=this.findTarget(t))&&e.fireEvent("click",t)}.bind(this),mousedown:function(t){var e,t=this.getMouse(t);this.dragTarget?this.fromPath(this.dragTarget).fireEvent("mousedown",t):(e=this.findTarget(t))&&e.fireEvent("mousedown",t)}.bind(this),mouseup:function(t){var e,t=this.getMouse(t);this.dragTarget?this.fromPath(this.dragTarget).fireEvent("mouseup",t):(e=this.findTarget(t))&&e.fireEvent("mouseup",t)}.bind(this),mousemove:function(t){var e,t=this.getMouse(t);this.dragTarget?this.fromPath(this.dragTarget).fireEvent("mousemove",t):(e=this.findTarget(t))?e.fullid!=this.lastMouseOverTarget?(e.fireEvent("mouseover",t),this.lastMouseOverTarget&&this.fromPath(this.lastMouseOverTarget).fireEvent("mouseout",t),this.lastMouseOverTarget=e.fullid):e.fireEvent("mousemove",t):this.lastMouseOverTarget&&(this.fromPath(this.lastMouseOverTarget).fireEvent("mouseout",t),this.lastMouseOverTarget=null)}.bind(this),dblclick:function(t){var e,t=this.getMouse(t);(e=this.findTarget(t))&&e.fireEvent("dblclick",t)}.bind(this),mouseleave:function(t){t=this.getMouse(t);this.dragTarget&&(this.fromPath(this.dragTarget).fireEvent("mouseup",t),this.dragTarget=null),this.lastMouseOverTarget&&(this.fromPath(this.lastMouseOverTarget).fireEvent("mouseout",t),this.lastMouseOverTarget=null)}.bind(this)})},setCtx:function(t){this.ctxEl="object"==typeof t?t:document.getElementById(t),this.ctx=t.getContext("2d")},getCtx:function(){return this.ctx},contains:function(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[0]+t[2]&&e[1]<=t[1]+t[3]},fromPath:function(t){return t=t.split("/"),this.layers.get(t[0]).get(t[1])},layerFromPath:function(t){return t=t.split("/"),this.layers.get(t[0])},findTarget:function(t){for(var e,s,i,r=this.layers.layers.length-1;e=this.layers.layers[r];r--)for(i in s=e.items.getClean())if(s[i].interactive&&s[i].dims&&this.contains(s[i].dims,t))return s[i];return!1},addThread:function(t){return t.options||(t=new Thread(t)),this.threads.set(t.options.id,t),t},removeThread:function(t){this.threads.get(t).destroy(),this.items.erase(t)},clear:function(t){return t=t||[0,0,this.ctxEl.get("width"),this.ctxEl.get("height")],this.ctx.clearRect(t[0],t[1],t[2],t[3]),this},draw:function(){this.layers.draw()}});
//# sourceMappingURL=CANVAS-min.js.map